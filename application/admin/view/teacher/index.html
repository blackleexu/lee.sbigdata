<style>
    #adminteacher{
        min-height: 90%;
    }
    #adminteacher .card{
        min-height: 100%;
    }
    #adminteacher #edit,#del{
        color: #ffffff;
    }
    /*#adminteacher .table td img{*/
        /*width: 55px;*/
        /*height: 30px;*/
         /*border-radius: 5%;*/
    /*}*/
    #adminteacher .dept_tree{
        padding-right: 0px;
        /*padding-left: 0px;*/
    }
</style>

{layout name="layouts/layout" /}
<div class="row"  id="adminteacher">
    <div class="col-md-2 grid-margin dept_tree">
        <div class="card">
            <div class="card-body">
                <h4 class="card-title mb-0">Statistics</h4>
                <!--<div class="d-flex justify-content-between align-items-center">-->
                    <!--<div class="d-inline-block pt-3">-->
                        <div class="d-flex">
                            <form class="layui-form" action="" id="myform"  enctype="multipart/form-data" method="POST" style="overflow-x: auto">
                                <div id="xtree1"></div>
                                <input type="hidden" value="{$info['teacher_ids']?$info['teacher_ids']:''}" id="dept_ids" name="dept_ids">
                            </form>
                        <!--</div>-->
                    <!--</div>-->
                </div>
            </div>
        </div>
    </div>
    <div class="col-md-10 grid-margin data-list">
        <div class="card">
            <div class="card-body">
                <div class="align-items-center mb-1 justify-content-between d-lg-flex d-xl-flex d-md-block d-block">
                    <h2 class="">教师总览</h2>
                    <div class="nav-wrapper d-inline-block mt-4 mt-lg-0">
                        <ul class="nav nav-pills">
                            <li class="nav-item">
                                <a class="nav-link btn btn-light mr-1 teacher_add" id="addteacher" href="#" data-title="添加课程" data-id=""
                                data-href="{:url('admin/teacherAdd')}"><i style="font: inherit" class="layui-icon layui-icon-add-1"></i>添加</a>
                            </li>
                            <li class="nav-item">
                                <a class="nav-link btn btn-light mr-1" href="#"><i style="font: inherit" class="layui-icon layui-icon-up"></i>导入</a>
                            </li>
                        </ul>
                    </div>
                </div>
                <div class="table-responsive">
                    <table class="table table-striped">
                        <thead>
                        <tr>
                            <th>ID</th>
                            <th>姓名</th>
                            <th>性别</th>
                            <th>头像</th>
                            <th>联系方式</th>
                            <th>操作</th>
                        </tr>
                        </thead>
                        <tbody>
                        {volist name='list' id='vo'}
                        <tr>
                            <td>{$i}</td>
                            <td>{$vo.name}</td>
                            <td>{$vo['sex']==1?'男':'女'}</td>
                            <td class="showPhotos"><img src="__STATIC__{$vo.avatar}" width="100px" alt=""></td>
                            <td>{$vo.email}</td>
                            <td>
                                <a class="layui-btn layui-btn-xs teacher_edit" lay-event="edit" data-id="{$vo.id}" data-href="{:url('admin/teacherAdd',['id'=>$vo.id])}">编辑</a>
                                <a class="layui-btn layui-btn-danger layui-btn-xs teacher_del" lay-event="del" data-id="{$vo.id}" data-href="{:url('admin/teacherDel',['id'=>$vo.id])}">删除</a>
                            </td>
                        </tr>
                        {/volist}
                        </tbody>
                    </table>
                </div>
                <div class="d-flex align-items-center justify-content-between flex-wrap">
                    <p class="mb-0"> 共 {$list->total()} 条</p>
                    <nav>
                        {$list->render()}
                    </nav>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    showphotos.init('.showPhotos');

    // deptTreeBuilder('xtree1',{$dept},function (ids) {
    //     $('#dept_ids').val(ids);
    // });
    noCheckboxTreeBuilder("#xtree1");

    $('.teacher_edit').on('click',function () {
        alt('编辑课程',$(this));
    });

    $('.teacher_add').on('click',function () {
        alt('添加课程',$(this));
    });

    function alt(title,dom){
        var this_e = dom;
        var url = this_e.data('href');
        var id = this_e.data('id');
        var save_url = '{:url("admin/teacherSaveAdd")}';
        layui_iframe.editBuilder(title,url,function (index,layero) {
            //获取弹出层的表单
            var form = layer.getChildFrame('#myform', index);
            verifyinput();
            //调用弹出层的富文本同步方法
            // var iframeWin = window[layero.find('iframe')[0]['name']];
            // iframeWin.syncTexrarea();
            if(id){
                save_url = '{:url("admin/teacherSaveAdd")}'+'?id='+id;
            }
            ajax_request.post(save_url,form.serialize(),function (res) {
                if(res.is_ok == 'ok'){
                    layer.msg(res.msg,{icon:6});
                    layer.close(index);
                    location.reload();//刷新页面
                }else{
                    layer.msg(res.msg,{icon:5});
                }
            })
        })
    }

    $('.teacher_del').on('click',function () {
        var url = $(this).data('href');

        layui.use("layer", function () {
            var layer = layui.layer;  //layer初始化
            layer.confirm('确认删除',{btn:['确认','取消']},
                function () {
                    $.post(url,{},function (data) {
                        if(data.is_ok=='ok'){
                            location.reload();//刷新页面
                            layer.msg(data.msg,{icon:6});
                        }else{
                            layer.msg(data.msg,{icon:5});
                        }
                    });
                });
        });
    });
</script>